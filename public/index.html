<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple Shot - Target Shooting Game</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="nav-logo">Apple Shot</div>
        <div class="nav-links">
            <a href="#home" class="active">Home</a>
            <a href="#rules">Rules</a>
            <a href="#prizes">Prizes</a>
            <a href="#ranking">Ranking</a>
            <a href="docs.html">Docs</a>
            <a href="game.html">Play</a>
        </div>
    </nav>

    <!-- Hero -->
    <section id="home" class="hero">
        <canvas id="heroBg" class="hero-canvas"></canvas>
        <div class="hero-content">
            <div class="hero-tag">season <span id="heroSeason">1</span> // live</div>
            <h1 class="hero-title">Apple<br>Shot</h1>
            <p class="hero-desc">35 levels. 1 shot each. 3 lives. Lose them all, you're done.<br>First place wins the pool every 30 minutes!</p>
            <a href="game.html" class="btn btn-primary hero-play">Enter Game</a>
            <div class="hero-stats" id="statsBar">
                <div class="hs-item">
                    <span class="hs-val" id="statPool">0.00</span>
                    <span class="hs-lbl">SOL pool</span>
                </div>
                <div class="hs-sep">/</div>
                <div class="hs-item">
                    <span class="hs-val" id="statTimer">30:00</span>
                    <span class="hs-lbl">next prize</span>
                </div>
                <div class="hs-sep">/</div>
                <div class="hs-item">
                    <span class="hs-val" id="statPlayers">0</span>
                    <span class="hs-lbl">players</span>
                </div>
                <div class="hs-sep">/</div>
                <div class="hs-item">
                    <span class="hs-val">35</span>
                    <span class="hs-lbl">levels</span>
                </div>
            </div>
            <div class="hero-links">
                <a href="ranking.html">ranking</a>
                <a href="docs.html">docs</a>
                <a href="#rules">rules</a>
            </div>
        </div>
    </section>

    <!-- Rules -->
    <section id="rules" class="section section-divider">
        <h2 class="section-title">How It Works</h2>
        <p class="section-subtitle">Simple rules. Maximum pressure.</p>
        <div class="rules-grid">
            <div class="rule-card">
                <div class="rule-number">01</div>
                <div class="rule-title">Free to Play</div>
                <div class="rule-desc">No gas, no fees to start. Just play. Collected tokens from the ecosystem are sent directly to winners' wallets.</div>
            </div>
            <div class="rule-card">
                <div class="rule-number">02</div>
                <div class="rule-title">Hit the Apple</div>
                <div class="rule-desc">Aim and shoot. You get 1 shot per level. Hit the apple to advance. Miss and you lose a life. 3 lives total.</div>
            </div>
            <div class="rule-card">
                <div class="rule-number">03</div>
                <div class="rule-title">35 Levels</div>
                <div class="rule-desc">Each level gets harder. Wind, movement, obstacles, time limits. Harder at the start, balanced through level 35.</div>
            </div>
            <div class="rule-card">
                <div class="rule-number">04</div>
                <div class="rule-title">Dynamic Difficulty</div>
                <div class="rule-desc">If too many players pass a level, it gets harder. If too many fail, it eases up. The game adapts.</div>
            </div>
            <div class="rule-card">
                <div class="rule-number">05</div>
                <div class="rule-title">Win the Pool</div>
                <div class="rule-desc">Every 30 minutes, the prize pool is distributed to the player who reached the highest level. Timer resets and pool refills!</div>
            </div>
            <div class="rule-card">
                <div class="rule-number">06</div>
                <div class="rule-title">Token Taxes</div>
                <div class="rule-desc">Prize pool is funded by token transaction taxes. The more trades, the bigger the pool. Powered by Solana.</div>
            </div>
        </div>
    </section>

    <!-- Prizes -->
    <section id="prizes" class="section section-divider">
        <h2 class="section-title">Prize Distribution</h2>
        <p class="section-subtitle">Every 30 minutes, the leader takes it all.</p>
        <div class="prize-grid">
            <div class="prize-card gold">
                <div class="prize-position">1st</div>
                <div class="prize-label">First Place</div>
                <div class="prize-value">100%</div>
                <div class="rule-desc">of the 30-min pool</div>
            </div>
            <div class="prize-card silver">
                <div class="prize-position">30</div>
                <div class="prize-label">Minutes</div>
                <div class="prize-value">Timer</div>
                <div class="rule-desc">countdown in-game</div>
            </div>
            <div class="prize-card bronze">
                <div class="prize-position">SOL</div>
                <div class="prize-label">Solana</div>
                <div class="prize-value">Auto</div>
                <div class="rule-desc">direct to wallet</div>
            </div>
        </div>

        <h3 class="section-title" style="margin-top: 48px; font-size: 20px;">How It Works</h3>
        <div class="economy-bars">
            <div class="econ-item">
                <span class="econ-label">Token Taxes</span>
                <div class="econ-bar"><div class="econ-fill" style="width: 100%"></div></div>
                <span class="econ-value">Fund Pool</span>
            </div>
            <div class="econ-item">
                <span class="econ-label">30 Min Timer</span>
                <div class="econ-bar"><div class="econ-fill" style="width: 100%"></div></div>
                <span class="econ-value">Countdown</span>
            </div>
            <div class="econ-item">
                <span class="econ-label">First Place</span>
                <div class="econ-bar"><div class="econ-fill" style="width: 100%"></div></div>
                <span class="econ-value">Wins All</span>
            </div>
        </div>
    </section>

    <!-- Ranking -->
    <section id="ranking" class="section section-divider">
        <h2 class="section-title">Leaderboard</h2>
        <p class="section-subtitle">Current season top players.</p>
        <table class="ranking-table">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Player</th>
                    <th>Level</th>
                    <th>Accuracy</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody id="rankingBody">
                <tr><td colspan="5" style="text-align:center; color: var(--gray); padding: 32px;">No players yet. Be the first.</td></tr>
            </tbody>
        </table>
        <div style="text-align: center; margin-top: 24px;">
            <a href="ranking.html" class="btn btn-secondary">Full Ranking</a>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <p>Apple Shot 2025 - Play at your own risk. This is a skill-based game.</p>
    </footer>

    <script>
        // Hero background animation
        (function() {
            var c = document.getElementById('heroBg');
            if (!c) return;
            var ctx = c.getContext('2d');
            var dots = [];
            function resize() {
                c.width = c.offsetWidth;
                c.height = c.offsetHeight;
                dots = [];
                for (var i = 0; i < 40; i++) {
                    dots.push({
                        x: Math.random() * c.width,
                        y: Math.random() * c.height,
                        vx: (Math.random() - 0.5) * 0.3,
                        vy: (Math.random() - 0.5) * 0.3,
                        r: Math.random() * 1.5 + 0.5
                    });
                }
            }
            resize();
            window.addEventListener('resize', resize);
            function draw() {
                ctx.clearRect(0, 0, c.width, c.height);
                // grid
                ctx.strokeStyle = 'rgba(0,255,65,0.03)';
                ctx.lineWidth = 1;
                for (var x = 0; x < c.width; x += 60) {
                    ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, c.height); ctx.stroke();
                }
                for (var y = 0; y < c.height; y += 60) {
                    ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(c.width, y); ctx.stroke();
                }
                // dots + connections
                for (var i = 0; i < dots.length; i++) {
                    var d = dots[i];
                    d.x += d.vx; d.y += d.vy;
                    if (d.x < 0 || d.x > c.width) d.vx *= -1;
                    if (d.y < 0 || d.y > c.height) d.vy *= -1;
                    ctx.beginPath();
                    ctx.arc(d.x, d.y, d.r, 0, Math.PI * 2);
                    ctx.fillStyle = 'rgba(0,255,65,0.25)';
                    ctx.fill();
                    for (var j = i + 1; j < dots.length; j++) {
                        var d2 = dots[j];
                        var dx = d.x - d2.x, dy = d.y - d2.y;
                        var dist = Math.sqrt(dx*dx + dy*dy);
                        if (dist < 120) {
                            ctx.beginPath();
                            ctx.moveTo(d.x, d.y);
                            ctx.lineTo(d2.x, d2.y);
                            ctx.strokeStyle = 'rgba(0,255,65,' + (0.06 * (1 - dist/120)) + ')';
                            ctx.stroke();
                        }
                    }
                }
                requestAnimationFrame(draw);
            }
            draw();
        })();

        // Load prize pool info
        var prizePoolData = null;
        function loadPrizePool() {
            fetch('/api/prize-pool').then(function(r) { return r.json(); }).then(function(data) {
                prizePoolData = data;
                document.getElementById('statPool').textContent = (data.currentPool || 0).toFixed(2);
                updateTimer();
            }).catch(function() {});
        }
        function updateTimer() {
            if (!prizePoolData) return;
            var remaining = prizePoolData.nextDistributionIn;
            if (remaining <= 0) {
                document.getElementById('statTimer').textContent = 'NOW!';
                loadPrizePool();
            } else {
                var mins = Math.floor(remaining / 60000);
                var secs = Math.floor((remaining % 60000) / 1000);
                document.getElementById('statTimer').textContent = String(mins).padStart(2, '0') + ':' + String(secs).padStart(2, '0');
            }
        }
        setInterval(function() {
            if (prizePoolData) {
                prizePoolData.nextDistributionIn = Math.max(0, prizePoolData.nextDistributionIn - 1000);
                updateTimer();
            }
        }, 1000);
        loadPrizePool();

        // Load season stats
        fetch('/api/season').then(function(r) { return r.json(); }).then(function(data) {
            document.getElementById('statPlayers').textContent = data.total_players || 0;
            var se = document.getElementById('heroSeason');
            if (se && data.id) se.textContent = data.id;
        }).catch(function() {});

        // Load ranking
        fetch('/api/ranking').then(function(r) { return r.json(); }).then(function(data) {
            var body = document.getElementById('rankingBody');
            if (!data.ranking || data.ranking.length === 0) return;
            body.innerHTML = '';
            data.ranking.slice(0, 10).forEach(function(r, i) {
                var posClass = i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
                var status = r.completed ? '<span style="color:var(--neon)">COMPLETED</span>' : 'Level ' + r.current_level;
                body.innerHTML += '<tr>' +
                    '<td><span class="rank-pos ' + posClass + '">' + (i + 1) + '</span></td>' +
                    '<td>' + r.username + '</td>' +
                    '<td>' + r.current_level + '/35</td>' +
                    '<td>' + r.accuracy + '%<div class="accuracy-bar"><div class="accuracy-fill" style="width:' + r.accuracy + '%"></div></div></td>' +
                    '<td>' + status + '</td></tr>';
            });
        }).catch(function() {});

        // Smooth scroll
        document.querySelectorAll('a[href^="#"]').forEach(function(a) {
            a.addEventListener('click', function(e) {
                e.preventDefault();
                var target = document.querySelector(this.getAttribute('href'));
                if (target) target.scrollIntoView({ behavior: 'smooth' });
            });
        });
    </script>
</body>
</html>
